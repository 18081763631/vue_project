{"remainingRequest":"C:\\Users\\lenovo\\Desktop\\vue-admin\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\lenovo\\Desktop\\vue-admin\\src\\views\\manage\\rules.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\lenovo\\Desktop\\vue-admin\\src\\views\\manage\\rules.vue","mtime":1585839394000},{"path":"C:\\Users\\lenovo\\Desktop\\vue-admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\lenovo\\Desktop\\vue-admin\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"C:\\Users\\lenovo\\Desktop\\vue-admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\lenovo\\Desktop\\vue-admin\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { getList, del, change, delAll, changeAll } from '@/api/rules'\nimport waves from '@/directive/waves' // 水波纹指令\nimport { getArrByKey } from '@/utils'\nimport tree from '@/utils/tree'\nimport rulesForm from './rules/form'\nimport treeTable from '@/components/TreeTable'\n\nexport default {\n  name: 'Rules',\n  components: { rulesForm, treeTable },\n  directives: {\n    waves\n  },\n  filters: {\n    statusFilter(status) {\n      const statusMap = {\n        0: '禁用',\n        1: '正常'\n      }\n      return statusMap[status]\n    }\n  },\n  data() {\n    return {\n      tableKey: 0,\n      list: null,\n      selectedRows: null,\n      listLoading: true,\n      expandAll: true,\n      columns: [\n        {\n          text: '名称',\n          value: 'title'\n        }\n      ],\n      listQuery: {\n        status: '-1',\n        title: ''\n      },\n      buttonDisabled: true,\n      deleting: false\n    }\n  },\n  computed: {\n    getRulesList() {\n      return tree.listToTreeMulti(this.list, 0, 'id', 'pid', 'children', { 'delete': false })\n    }\n  },\n  watch: {\n  },\n  created() {\n    this.fetchList()\n  },\n  methods: {\n    fetchList() {\n      this.listLoading = true\n      getList(this.listQuery).then(response => {\n        this.list = response.data.data\n        this.listLoading = false\n      })\n    },\n    handleFilterClear() {\n      this.listQuery = {\n        status: '-1',\n        title: ''\n      }\n      this.fetchList()\n    },\n    handleSelectionChange(val) {\n      if (val.length > 0) {\n        this.buttonDisabled = false\n      } else {\n        this.buttonDisabled = true\n      }\n      this.selectedRows = val\n    },\n    handleCreate() {\n      this.$refs.fromRules.handleCreate()\n    },\n    handleUpdate(index, id) {\n      this.$refs.fromRules.handleUpdate(id)\n    },\n    handleModifyStatus(index, id, status) {\n      const statusObj = { 'status': 1 - status }\n      this.list = tree.upadteArr(this.list, 'id', id, statusObj)\n      change(id, 'status', 1 - status).then(response => {})\n    },\n    updateRow(temp) {\n      this.fetchList()\n    },\n    handleDelete(index, id) {\n      const _this = this\n      this.$confirm('此操作将永久删除该记录, 是否继续?', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(() => {\n        const delObj = { 'delete': true }\n        _this.list = tree.upadteArr(_this.list, 'id', id, delObj)\n        del(id).then(response => {\n          if (response.status === 1) {\n            _this.$notify.success(response.msg)\n            _this.fetchList()\n          } else {\n            _this.$notify.error(response.msg)\n          }\n          const delObj = { 'delete': false }\n          _this.list = tree.upadteArr(_this.list, 'id', id, delObj)\n        }).catch((error) => {\n          const delObj = { 'delete': false }\n          _this.list = tree.upadteArr(_this.list, 'id', id, delObj)\n        })\n      }).catch(() => {\n        this.$message({\n          type: 'info',\n          message: '已取消删除'\n        })\n      })\n    },\n    handleDeleteAll() {\n      const _this = this\n      if (this.selectedRows.length > 0) {\n        this.$confirm('此操作将永久删除该记录, 是否继续?', '提示', {\n          confirmButtonText: '确定',\n          cancelButtonText: '取消',\n          type: 'warning'\n        }).then(() => {\n          _this.deleting = true\n          const ids = getArrByKey(_this.selectedRows, 'id')\n          const idstr = ids.join(',')\n          delAll({ ids: idstr }).then(response => {\n            if (response.status === 1) {\n              _this.$message.success(response.msg)\n              _this.fetchList()\n            } else {\n              _this.$message.error(response.msg)\n            }\n            _this.deleting = false\n          }).catch((error) => {\n            _this.deleting = false\n          })\n        }).catch(() => {\n          this.$message({\n            type: 'info',\n            message: '已取消删除'\n          })\n        })\n      } else {\n        _this.$message.error('请选择要删除的数据')\n      }\n    },\n    handleCommand(command) {\n      const _this = this\n      if (this.selectedRows.length > 0) {\n        const ids = getArrByKey(this.selectedRows, 'id')\n        const idstr = ids.join(',')\n        changeAll({ val: idstr, field: 'status', value: command }).then(response => {\n          if (response.status === 1) {\n            _this.$message.success(response.msg)\n            _this.fetchList()\n          } else {\n            _this.$message.error(response.msg)\n          }\n        }).catch((error) => {\n        })\n      } else {\n        _this.$message.error('请选择要操作的数据')\n      }\n    }\n  }\n}\n",{"version":3,"sources":["rules.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqFA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"rules.vue","sourceRoot":"src/views/manage","sourcesContent":["<template>\n  <div class=\"app-container\">\n    <!-- 操作 -->\n    <el-row style=\"margin-bottom: 10px;\">\n      <el-col :xs=\"24\" :sm=\"24\" :lg=\"24\">\n        <el-tooltip content=\"刷新\" placement=\"top\">\n          <el-button v-waves type=\"warning\" icon=\"el-icon-refresh\" circle @click=\"handleFilterClear\"/>\n        </el-tooltip>\n        <el-tooltip content=\"添加\" placement=\"top\">\n          <el-button v-waves type=\"success\" icon=\"el-icon-plus\" circle @click=\"handleCreate\"/>\n        </el-tooltip>\n        <el-tooltip content=\"删除\" placement=\"top\">\n          <el-button v-waves :loading=\"deleting\" :disabled=\"buttonDisabled\" type=\"danger\" icon=\"el-icon-delete\" circle @click=\"handleDeleteAll()\"/>\n        </el-tooltip>\n        <el-tooltip content=\"更多\" placement=\"top\">\n          <el-dropdown trigger=\"click\" placement=\"bottom\" style=\"margin-left: 10px;\" @command=\"handleCommand\">\n            <el-button :disabled=\"buttonDisabled\" type=\"Info\" circle>\n              <i class=\"el-icon-more\"/>\n            </el-button>\n            <el-dropdown-menu slot=\"dropdown\" >\n              <el-dropdown-item command=\"1\">设为正常</el-dropdown-item>\n              <el-dropdown-item command=\"0\">设为禁用</el-dropdown-item>\n            </el-dropdown-menu>\n          </el-dropdown>\n        </el-tooltip>\n      </el-col>\n    </el-row>\n\n    <!-- 表格 -->\n    <tree-table\n      v-loading=\"listLoading\"\n      :key=\"tableKey\"\n      :data=\"getRulesList\"\n      :expand-all=\"expandAll\"\n      :columns=\"columns\"\n      border\n      fit\n      highlight-current-row\n      style=\"width: 100%;\"\n      @selection-change=\"handleSelectionChange\">\n      <el-table-column label=\"标识\" width=\"150px\" align=\"center\">\n        <template slot-scope=\"scope\">\n          <span>{{ scope.row.name }}</span>\n        </template>\n      </el-table-column>\n      <el-table-column label=\"图标\" width=\"80px\" align=\"center\">\n        <template slot-scope=\"scope\">\n          <span>{{ scope.row.icon }}</span>\n        </template>\n      </el-table-column>\n      <el-table-column label=\"路径\" width=\"150px\" align=\"center\">\n        <template slot-scope=\"scope\">\n          <span>{{ scope.row.path }}</span>\n        </template>\n      </el-table-column>\n      <el-table-column label=\"组件\" width=\"150px\" align=\"center\">\n        <template slot-scope=\"scope\">\n          <span>{{ scope.row.component }}</span>\n        </template>\n      </el-table-column>\n      <el-table-column label=\"状态\" width=\"80px\" align=\"center\">\n        <template slot-scope=\"scope\">\n          <span :class=\"{'el-icon-success text-green':scope.row.status == 1,'el-icon-error text-red':scope.row.status == 0}\" @click=\"handleModifyStatus(scope.$index,scope.row.id,scope.row.status)\">{{ scope.row.status | statusFilter }}</span>\n        </template>\n      </el-table-column>\n\n      <el-table-column label=\"操作\" align=\"center\" width=\"120px\" class-name=\"small-padding\">\n        <template slot-scope=\"scope\">\n          <el-tooltip content=\"编辑\" placement=\"top\">\n            <el-button v-waves type=\"primary\" icon=\"el-icon-edit-outline\" circle @click=\"handleUpdate(scope.$index,scope.row.id)\"/>\n          </el-tooltip>\n          <el-tooltip content=\"删除\" placement=\"top\">\n            <el-button v-waves :loading=\"scope.row.delete\" type=\"danger\" icon=\"el-icon-delete\" circle @click=\"handleDelete(scope.$index,scope.row.id)\"/>\n          </el-tooltip>\n        </template>\n      </el-table-column>\n    </tree-table>\n\n    <!-- 表单 -->\n    <rulesForm ref=\"fromRules\" :rule-list=\"list\" @updateRow=\"updateRow\"/>\n\n  </div>\n</template>\n\n<script>\nimport { getList, del, change, delAll, changeAll } from '@/api/rules'\nimport waves from '@/directive/waves' // 水波纹指令\nimport { getArrByKey } from '@/utils'\nimport tree from '@/utils/tree'\nimport rulesForm from './rules/form'\nimport treeTable from '@/components/TreeTable'\n\nexport default {\n  name: 'Rules',\n  components: { rulesForm, treeTable },\n  directives: {\n    waves\n  },\n  filters: {\n    statusFilter(status) {\n      const statusMap = {\n        0: '禁用',\n        1: '正常'\n      }\n      return statusMap[status]\n    }\n  },\n  data() {\n    return {\n      tableKey: 0,\n      list: null,\n      selectedRows: null,\n      listLoading: true,\n      expandAll: true,\n      columns: [\n        {\n          text: '名称',\n          value: 'title'\n        }\n      ],\n      listQuery: {\n        status: '-1',\n        title: ''\n      },\n      buttonDisabled: true,\n      deleting: false\n    }\n  },\n  computed: {\n    getRulesList() {\n      return tree.listToTreeMulti(this.list, 0, 'id', 'pid', 'children', { 'delete': false })\n    }\n  },\n  watch: {\n  },\n  created() {\n    this.fetchList()\n  },\n  methods: {\n    fetchList() {\n      this.listLoading = true\n      getList(this.listQuery).then(response => {\n        this.list = response.data.data\n        this.listLoading = false\n      })\n    },\n    handleFilterClear() {\n      this.listQuery = {\n        status: '-1',\n        title: ''\n      }\n      this.fetchList()\n    },\n    handleSelectionChange(val) {\n      if (val.length > 0) {\n        this.buttonDisabled = false\n      } else {\n        this.buttonDisabled = true\n      }\n      this.selectedRows = val\n    },\n    handleCreate() {\n      this.$refs.fromRules.handleCreate()\n    },\n    handleUpdate(index, id) {\n      this.$refs.fromRules.handleUpdate(id)\n    },\n    handleModifyStatus(index, id, status) {\n      const statusObj = { 'status': 1 - status }\n      this.list = tree.upadteArr(this.list, 'id', id, statusObj)\n      change(id, 'status', 1 - status).then(response => {})\n    },\n    updateRow(temp) {\n      this.fetchList()\n    },\n    handleDelete(index, id) {\n      const _this = this\n      this.$confirm('此操作将永久删除该记录, 是否继续?', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(() => {\n        const delObj = { 'delete': true }\n        _this.list = tree.upadteArr(_this.list, 'id', id, delObj)\n        del(id).then(response => {\n          if (response.status === 1) {\n            _this.$notify.success(response.msg)\n            _this.fetchList()\n          } else {\n            _this.$notify.error(response.msg)\n          }\n          const delObj = { 'delete': false }\n          _this.list = tree.upadteArr(_this.list, 'id', id, delObj)\n        }).catch((error) => {\n          const delObj = { 'delete': false }\n          _this.list = tree.upadteArr(_this.list, 'id', id, delObj)\n        })\n      }).catch(() => {\n        this.$message({\n          type: 'info',\n          message: '已取消删除'\n        })\n      })\n    },\n    handleDeleteAll() {\n      const _this = this\n      if (this.selectedRows.length > 0) {\n        this.$confirm('此操作将永久删除该记录, 是否继续?', '提示', {\n          confirmButtonText: '确定',\n          cancelButtonText: '取消',\n          type: 'warning'\n        }).then(() => {\n          _this.deleting = true\n          const ids = getArrByKey(_this.selectedRows, 'id')\n          const idstr = ids.join(',')\n          delAll({ ids: idstr }).then(response => {\n            if (response.status === 1) {\n              _this.$message.success(response.msg)\n              _this.fetchList()\n            } else {\n              _this.$message.error(response.msg)\n            }\n            _this.deleting = false\n          }).catch((error) => {\n            _this.deleting = false\n          })\n        }).catch(() => {\n          this.$message({\n            type: 'info',\n            message: '已取消删除'\n          })\n        })\n      } else {\n        _this.$message.error('请选择要删除的数据')\n      }\n    },\n    handleCommand(command) {\n      const _this = this\n      if (this.selectedRows.length > 0) {\n        const ids = getArrByKey(this.selectedRows, 'id')\n        const idstr = ids.join(',')\n        changeAll({ val: idstr, field: 'status', value: command }).then(response => {\n          if (response.status === 1) {\n            _this.$message.success(response.msg)\n            _this.fetchList()\n          } else {\n            _this.$message.error(response.msg)\n          }\n        }).catch((error) => {\n        })\n      } else {\n        _this.$message.error('请选择要操作的数据')\n      }\n    }\n  }\n}\n</script>\n<style rel=\"stylesheet/scss\" lang=\"scss\">\n\t.text-red{\n\t\tcolor: red;\n\t\tcursor: pointer;\n\t}\n\t.text-green{\n\t\tcolor: green;\n\t\tcursor: pointer;\n\t}\n</style>\n"]}]}